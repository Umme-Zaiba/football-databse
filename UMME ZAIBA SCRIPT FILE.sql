use football_uz;

-- CREATE STATEMENTS

CREATE TABLE TEAMS (
	TEAM_ID INT PRIMARY KEY,
    TEAM_NAME VARCHAR(30),
    COUNTRY VARCHAR(30),   
    );
   
CREATE TABLE PLAYERS (
	PLAYER_ID INT PRIMARY KEY,
	TEAM_ID INT,
	PLAYER_NAME VARCHAR(20),
    POSITION_PLAYER INT,
    CLUB VARCHAR(30),
    NATIONALITY VARCHAR(30),
    AGE INT
    FOREIGN KEY(TEAM_ID) references TEAMS(TEAM_ID)
    );
   
CREATE TABLE POSITION_STATS(
	POSITION_ID INT PRIMARY KEY,
    POSITION_NAME VARCHAR(20)
    );
   
CREATE TABLE MATCHES(
	MATCH_ID INT PRIMARY KEY,
    MATCH_DATE_TIME DATETIME,
    HOME_TEAM VARCHAR(30),
    AWAY_TEAM VARCHAR(30),
    MATCH_GOALS int,
    STADIUM_LOCATION VARCHAR(30)
    );
    
CREATE TABLE COACH (
	COACH_ID VARCHAR(30),
	TEAM_ID INT,
    COACH_NAME VARCHAR(30),
    FOREIGN KEY (TEAM_ID) REFERENCES TEAMS(TEAM_ID)
    );
   
 
CREATE TABLE STADIUM (
	STADIUM_ID INT PRIMARY KEY,
    STADIUM_NAME VARCHAR(50),
    CITY VARCHAR(20),
    MATCH_ID INT,
    FOREIGN KEY(MATCH_ID ) REFERENCES MATCHES(MATCH_ID)
    );
  desc COACH;
  

 
CREATE TABLE GOAL(
	GOAL_ID INT PRIMARY KEY,
    MATCH_ID INT,
    PLAYER_ID INT,
    GOAL_TIME TIME,
    FOREIGN KEY (MATCH_ID ) references MATCHES(MATCH_ID ),
    FOREIGN KEY (PLAYER_ID) references PLAYERS(PLAYER_ID)
    );

CREATE TABLE CARDS (
	CARD_ID INT PRIMARY KEY,
	match_id int,
	player_id int,
	team_id int,
	FOREIGN KEY (MATCH_ID ) references MATCHES(MATCH_ID ),
    FOREIGN KEY (PLAYER_ID) references PLAYERS(PLAYER_ID),
    FOREIGN KEY (team_id) references teams(team_id),
    CARD_TYPE VARCHAR(20),
    card_time datetime
    );
   
CREATE TABLE REFREE (
	REFREE_ID INT primary KEY,
    REFREE_NAME VARCHAR(30),
    COUNTRY VARCHAR(20),
    MATCH_ID INT,
    CARD_ID INT,
    foreign key (MATCH_ID) references MATCHES(MATCH_ID),
    foreign key (CARD_ID) references CARDS(CARD_ID)
    );

--  DESCRIBE TABLES
desc TEAMS;  
   

-- INSERT STATEMENTS
 
INSERT INTO TEAMS VALUES(1,'RED AND BLACKS', 'ALBANAIA');
INSERT INTO TEAMS VALUES(2,'WHITE AND SKY BLUES', 'ARGENTINA');
INSERT INTO TEAMS VALUES(3,'THE SOCCESROOS', 'AUSTRALIA');
INSERT INTO TEAMS VALUES(4,'RAKE AND SCRAPE BOYS', 'BAHAMAS');
INSERT INTO TEAMS VALUES(5,'THE RED WOLVES', 'BAHRAIN');
INSERT INTO TEAMS VALUES(6,'THE RED DEVILS', 'BELGIUM');
INSERT INTO TEAMS VALUES(7,'THE GOMBEY WARRIORS','BERMUDA');
INSERT INTO TEAMS VALUES(8,'THE YELLOW DRAGONS', 'BHUTAN');
INSERT INTO TEAMS VALUES(9,'LA VERDE', 'BOLIVIA');
INSERT INTO TEAMS VALUES(10,'NATURE BOYZ', 'BRITISH VIRGIN ISLANDS');
INSERT INTO TEAMS VALUES(11,'LITTLE CANARY', 'BRAZIL');
INSERT INTO TEAMS VALUES(12,'THE LIONS', 'BULGARIA');
INSERT INTO TEAMS VALUES(13,'THE TURTULES', 'CAYMAN ISLANDS');
INSERT INTO TEAMS VALUES(14,'TRICOLOR', 'ECUADOR');
INSERT INTO TEAMS VALUES(15,'THE BLUES', 'FRANCE');
INSERT INTO TEAMS VALUES(16,'BLUE TIGERS', 'INDIA');
INSERT INTO TEAMS VALUES(17,'SAMURAI BLUES', 'JAPAN');
INSERT INTO TEAMS VALUES(18,'MALYASIAN TIGERS', 'MALYASIA');
INSERT INTO TEAMS VALUES(19,'THE LIONS OF ATLAS', 'MOROCCO');
INSERT INTO TEAMS VALUES(20,'THE ALL WHITES', 'NEW ZEALAND');
INSERT INTO TEAMS VALUES(21,'THE SUPER EAGLES', 'NIGERIA');
INSERT INTO TEAMS VALUES(22,'THE RED TIDE', 'PANAMA');
INSERT INTO TEAMS VALUES(23,'THE FORTS', 'PORTUGAL');
INSERT INTO TEAMS VALUES(24,'THE CRIMSONS', 'QATAR');
INSERT INTO TEAMS VALUES(25,'SBORNAYA', 'RUSSIA');
INSERT INTO TEAMS VALUES(26,'THE GREEN FALCONS', 'SAUDI ARABIA');
INSERT INTO TEAMS VALUES(27,'THE LIONS', 'SINGAPORE');
INSERT INTO TEAMS VALUES(28,'THE RED FURRY', 'SPAIN');
INSERT INTO TEAMS VALUES(29,'THE STARS AND STRIPES', 'USA');
INSERT INTO TEAMS VALUES(30,'THE BURGUNDIES', 'VENEZUELA');
INSERT INTO TEAMS VALUES(31,'THE WARRIORS', 'ZIMBABWE');

INSERT INTO PLAYERS VALUES(1, 2, 'LIONEL MESSI', 'FORWARD','BARCELONA','ARGENTINA',40);
INSERT INTO PLAYERS VALUES(2, 5, 'CHRISTIANO RONALDO', 'FORWARD','REAL MADRID','PORTUGAL',35);
INSERT INTO PLAYERS VALUES(3, 2, 'XAVI', 'MIDFIELDER','BARCELONA','SPAIN',36);
INSERT INTO PLAYERS VALUES(4, 8, 'ANDRES INIESTA', 'MIDFIELDER','BARCELONA','SPAIN',36);
INSERT INTO PLAYERS VALUES(5, 2, 'ZLATAN IBRAHIMOVIC', 'FORWARD','PSG','SWEDEN',29);
INSERT INTO PLAYERS VALUES(6, 9, 'RADAMEL FALCAO', 'FORWARD','ATLETICO MADRID','COLOMBIA',25);
INSERT INTO PLAYERS VALUES(7, 10, 'ROBIN VAN PERSIE', 'FORWARD','MAN UTD','NETHERLANDS',31);
INSERT INTO PLAYERS VALUES(8, 11, 'ANDREA PIRLO', 'MIDFIELDER','JUVENTUS','ITALY',24);
INSERT INTO PLAYERS VALUES(9, 2, 'SERGIO AGUERO','FORWARD', 'MAN CIY','ARGENTINA',34);
INSERT INTO PLAYERS VALUES(10, 1, 'NEYMAR', 'FORWARD','SANTOS','BRAZIL',39);
INSERT INTO PLAYERS VALUES(11, 1, 'OSCAR', 'MIDFIELDER','CHELSEA','BRAZIL',28);
INSERT INTO PLAYERS VALUES(12, 1, 'FERNANDINHO', 'MIDFIELDER','SHAKHTAR DONESTSK','BRAZIL',27);
INSERT INTO PLAYERS VALUES(13, 2, 'JAVIER MASCHERANO', 'MIDFIELDER','BARCELONA','ARGENTINA',31);
INSERT INTO PLAYERS VALUES(14, 1, 'DANI ALVES', 'DEFENDER','BARCELONA','BRAZIL',30);
INSERT INTO PLAYERS VALUES(15, 1, 'MARCELO', 'DEFENDER','REAL MADRID','BRAZIL',22);
INSERT INTO PLAYERS VALUES(16, 3, 'DAVID SILVA', 'MIDFIELDER','MAN CITY','SPAIN',24);

INSERT INTO COACH VALUES(1,1,'PAUL BRYANT');
INSERT INTO COACH VALUES(2,2,'NICK SABAN');
INSERT INTO COACH VALUES(3,1,'KNUTE ROCKNE');
INSERT INTO COACH VALUES(4,6,'TOM OSBORNE');
INSERT INTO COACH VALUES(5,5,'EDDIE ROBINSON');
INSERT INTO COACH VALUES(6,2,'CHARLES WILKINSON');
INSERT INTO COACH VALUES(7,3,'Joe Paterno');
INSERT INTO COACH VALUES(8,3,'BOBBY BOWDEN');
INSERT INTO COACH VALUES(9,4,'WODDY HAYES');
INSERT INTO COACH VALUES(10,7,'FRANK LEAHY');
INSERT INTO COACH VALUES(11,8,'GLENN WARNER');
INSERT INTO COACH VALUES(12,9,'JOHN MCKAY');
INSERT INTO COACH VALUES(13,10,'BARRY SWITZER');
INSERT INTO COACH VALUES(14,11,'AMOS ALONZO');
INSERT INTO COACH VALUES(15,12,'ARA PARSEGHIAN');

desc MATCHES;

INSERT INTO MATCHES VALUES (1, '2020-7-2 13:23:44','ARGENTINA','BRAZIL',8,'MICHIGAN');
INSERT INTO MATCHES VALUES (2, '2020-7-2 21:23:44','ALBANIA','COLMBIA',9,'OHIO');
INSERT INTO MATCHES VALUES (3, '2020-7-3 13:23:44','BELGIUM','BAHRAIN',10,'JOHANNESBURG');
INSERT INTO MATCHES VALUES (4, '2020-7-3 21:23:44','AUSTRALIA','BAHAMAS',11,'PASEDENA');
INSERT INTO MATCHES VALUES (5, '2020-7-4 13:23:44','ARGENTINA','COLMBIA',11,'ATHENS');
INSERT INTO MATCHES VALUES (6, '2020-7-4 21:23:44','BELGIUM','AUSRALIA',12,'TEXAS');
INSERT INTO MATCHES VALUES (7, '2021-7-6 13:23:44','PORTUGAL','MOROCCO',10,'MEXICO');
INSERT INTO MATCHES VALUES (8, '2021-7-2 21:23:44','GERMANY','ITALY',10,'AUSTRALIA');
INSERT INTO MATCHES VALUES (9, '2021-7-6 16:23:44','CHILE','SWEDEN',11,'MALYASIA');
INSERT INTO MATCHES VALUES (10, '2010-7-16 13:23:44','PORTUGAL','CHILE',13,'KOLKATA');

INSERT INTO STADIUM VALUES (1,'MICHIGAN STADIUM', 'MICHIGAN',1);
INSERT INTO STADIUM VALUES (2,'OHIO STADIUM', 'OHIO',5);
INSERT INTO STADIUM VALUES (3,'FNB STADIUM', 'JOHANNESBURG',1);
INSERT INTO STADIUM VALUES (4,'ROSE BOWL STADIUM', 'PASEDENA',2);
INSERT INTO STADIUM VALUES (5,'SANFORD STADIUM', 'ATHENS',3);
INSERT INTO STADIUM VALUES (6,'COTTON BOWL STADIUM', 'TEXAS',4);
INSERT INTO STADIUM VALUES (7,'BEIJING NATIONAL STADIUM', 'BEIJING',5);
INSERT INTO STADIUM VALUES (8,'WEMBLEY STADIUM', 'LONDON',9);
INSERT INTO STADIUM VALUES (9,'ESTADIO STADIUM', 'MEXICO',6);
INSERT INTO STADIUM VALUES (10,'SALT LAKE STADIUM', 'KOLKATA',7);
INSERT INTO STADIUM VALUES (11,'STADIUM AUSTRALIA','AUSTRALIA',8);
INSERT INTO STADIUM VALUES (12,'SHAH ALAM STADIUM', 'MALYASIA',10);
INSERT INTO STADIUM VALUES (13,'AT&T STADIUM', 'ARLINGTON',10);

insert into POSITION_STATS values
(1,'GOALKEEPER'),
  (2, 'RUNNING BACK'),
 (3, 'RECIEVER'),
 (4,'LEFT TACKLE'),
 (5, 'LEFT GUARD'),
 (6,'CENTER'),
 (7, 'RIGHT GUARD'),
 (8,'RIGHT TACKLE'),
 (9, 'FULLBACK'),
 (10, 'TIGHT END'),
 (11, 'OFFENSIVE TACKLES')
;

desc GOAL;
insert into GOAL values 
(4,1,2,'14:15:19'),
(5,2,1,'04:05:16'),
(6,3,3,'14:17:16'),
(7,4,4,'14:15:16'),
(8,5,5,'14:15:16'),
(9,6,6,'14:15:16'),
(10,7,7,'14:15:16'),
(11,8,8,'14:15:16'),
(12,9,9,'14:15:16'),
(13,10,13,'14:15:16')
;

insert into CARDS values
(1,1,1,3,'yellow','2022-10-01 14:25:16'),
(2,2,2,4,'red','2022-10-08 17:30:23'),
(3,3,3,5,'yellow','2022-10-10 12:15:58'),
(4,4,4,9,'yellow','2022-11-10 12:15:58'),
(5,5,5,6,'red','2022-11-28 19:40:10'),
(6,6,6,1,'yellow','2022-11-08 18:20:34'),
(7,7,7,2,'yellow','2022-12-03 22:50:30'),
(8,8,8,7,'yellow','	2022-12-11 18:55:48'),
(9,9,9,11,'yellow','2022-5-04 16:15:36'),
(10,10,10,13,'red','2022-2-05 19:30:23')
;

insert into REFREE values
(1,'Ivan Barton','Slovenia',1,1),
(2,'Chris BeatH','Australia',2,3),
(3,'Raphael Claus','Brazil',4,5),
(4,'Matthew Conger','New Zealand',3,2),
(5,'Ismail Elfath','United States',5,4),
(6,'Mario Escobar','Guatemala',6,7),
(7,'Alireza Faghani','Iran',7,6),
(8,'Istvan Kovacs','Romania',8,9),
(9,'Ning Ma','China',9,8),
(10,'Antonio Mateu','Spain',10,10)
;

-- select statements

select * from STADIUM;
select * from MATCHES;
select * from COACH;
select * from CARDS;
select * from GOAL;
select * from PLAYERS;
select * from TEAMS;
select * from STADIUM;


-- where statement 

select PLAYER_NAME  from PLAYERS where TEAM_ID = 2;
select CARD_ID,MATCH_ID,PLAYER_ID from CARDS where CARD_TYPE='YELLOW';
select TEAM_NAME,TEAM_ID from TEAMS where TEAM_NAME like 'THE%';


-- update statement 

update cards 
set card_type='red'
where card_id =8;
select * from CARDS;


-- OPERATORS

select * from refree 
where COUNTRY ='AUSTRALIA' or COUNTRY='SPAIN';

select * from TEAMS 
where TEAM_NAME='THE BLUES' OR TEAM_NAME ='THE LIONS';

select TEAM_ID,PLAYER_ID,CARD_TYPE from CARDS
where not CARD_TYPE= 'RED';


-- join statements - on SAME columns OF DIFF TABLES

-- join
SELECT *
FROM teams
JOIN players ON teams.team_id = players.team_id;

-- inner join
-- Retrieve all players who have scored goals in a particular match

SELECT players.*
FROM players
INNER JOIN goal ON players.player_id = goal.player_id
WHERE goal.match_id = match_id
order by PLAYER_ID DESC;

-- left JOIN

select CARD_ID, CARD_TYPE,MATCHES.MATCH_ID 
from cards c 
left join MATCHES on c.MATCH_ID = MATCHES.MATCH_ID ;


-- Order by statement , 
	-- to  Retrieve all the matches played  and sort them by their date in asc order
	
	SELECT * FROM matches ORDER BY match_date_time ASC;

select COACH_NAME,TEAM_ID from COACH order by TEAM_ID asc;

-- select GOAL_ID,MATCH_ID
-- from goal g 
-- right join PLAYERS on G.PLAYER_ID = PLAYERS.PLAYER_ID
-- where not GOAL_ID=4 
-- order by GOAL_ID;


-- group by 
select match_goals, count(*) from matches group by match_goals ;


-- aggregate functions
select count(player_name) from players; 
SELECT SUM(match_goals) FROM matches;
select avg(match_goals) from matches;
select min(match_goals) from matches;
select max(GOAL_ID) from goal;


-- CASE FUNCTIONS
select GOAL_ID as GOAL_SCORED,
case
	when GOAL_ID < 5 then 'AVERAGE FOOTBALL PLAYER'
	when GOAL_ID =5 then 'GOOD PLAYER'
	when GOAL_ID =6 or (GOAL_ID=7) or GOAL_ID=8 or GOAL_ID=9 then 'BEST OF ALL TIME'
	when GOAL_ID >=10 then 'GOAT'
	else 'NOT A GOOD PLAYER'
end as GOAL_RESULTS
from GOAL;


-- wildcards 

select * from players 
where player_name like 'da%';


-- regular expression

select city  from stadium s
where s.CITY regexp 'n$';

select city  from stadium s
where s.CITY regexp '^a';


-- USE OF LIMIT_

select * from players limit 10;


-- offset :

select * from players limit 10 offset 10;

select player_name, nationality 
from players 
order by player_name asc
limit 15;


-- UNION

select coach_name from coach 
union
select refree_name from refree 
order by COACH_NAME asc;


-- union ALL

select match_id from stadium
union all
select match_id from matches;


-- VIEW

create view brazilian_team as 
select PLAYER_ID,PLAYER_NAME from PLAYERS
where NATIONALITY = 'BRAZIL';


drop view brazilian_team;


-- --update view

create or replace view brazilian_team as
select PLAYER_ID,PLAYER_NAME,POSITION_PLAYER from PLAYERS 
where NATIONALITY = 'BRAZIL';

select * from brazilian_team;

drop view brazilian_team;

-- --stored procedure :

create procedure getPlayer(in player_id int)
begin
	select p.player_name,t.team_name from `players`  p inner join `teams` t on p.team_id = t.team_id;
end

call getPlayer(2);

-- drop procedure
drop procedure getplayer;





